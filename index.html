<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å°¾ç‰™åº§ä½æŸ¥è©¢ç³»çµ± - æ•ˆèƒ½å„ªåŒ–ç‰ˆ</title>
<style>
  /* åŸºç¤è¨­å®š */
  body {
    margin: 0;
    padding: 15px;
    font-family: -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
    /* ç§»é™¤èƒŒæ™¯æ¨¡ç³Šï¼Œæ”¹ç”¨åŠé€æ˜ç–Šå±¤é”åˆ°è¦–è¦ºæ•ˆæœï¼Œé€™å°æ‰‹æ©Ÿæ•ˆèƒ½æ›´å¥½ */
    background: #f8f9fa url('bg.jpg') center center / cover fixed no-repeat;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  .container { max-width: 800px; margin: auto; position: relative; z-index: 10; }

  /* æœå°‹æ¡†å„ªåŒ– */
  .search-box { display: flex; gap: 8px; margin-bottom: 20px; }
  .search-box input { 
    flex: 1; padding: 12px; font-size: 16px; border-radius: 12px; 
    border: 2px solid #ddd; outline: none; background: white; 
    -webkit-appearance: none; /* ç§»é™¤ iOS å…§å»ºé™°å½± */
  }
  .search-box input:focus { border-color: #f43f5e; }
  .search-box button { 
    padding: 12px 20px; font-size: 16px; border: none; border-radius: 12px; 
    background: #f43f5e; color: #fff; 
    cursor: pointer; font-weight: bold;
    touch-action: manipulation; /* æ¸›å°‘è¡Œå‹•ç«¯é»æ“Šå»¶é² */
  }
  
  /* å¡ç‰‡è¨­è¨ˆ - ç§»é™¤ backdrop-filter ä»¥æå‡æµæš¢åº¦ */
  .card { 
    background: white; /* æ”¹ç‚ºç´”è‰²æˆ–é«˜ä¸é€æ˜åº¦ç™½è‰² */
    border-radius: 20px; 
    padding: 20px; margin-bottom: 20px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateZ(0); /* å¼·åˆ¶é–‹å•Ÿ GPU åŠ é€Ÿ */
  }

  .guest-list { 
    max-height: 250px; overflow-y: auto; border: 1px solid #eee; background: #fff; 
    -webkit-overflow-scrolling: touch; /* iOS æ»¾å‹•æµæš¢å¿…å‚™ */
  }

  .guest-item { 
    padding: 15px; border-bottom: 1px solid #eee; 
    display: flex; justify-content: space-between; align-items: center;
    touch-action: manipulation;
  }
  
  /* åº§ä½åœ–æ»¾å‹•å„ªåŒ– */
  .seating-wrapper {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•é †åº¦ */
    padding-bottom: 10px;
    display: flex;
    will-change: transform; /* é å‘Šç€è¦½å™¨æœƒæœ‰è®Šå‹• */
  }

  .seating { 
    display: inline-flex; flex-direction: column; align-items: center; 
    margin: 10px auto; min-width: max-content;
    padding: 10px;
  }

  .row { display: flex; gap: 8px; margin-bottom: 8px; }

  .table { 
    width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; 
    border-radius: 50%; border: 1px solid #ddd; background: #fdfdfd; 
    font-size: 11px; font-weight: bold; color: #666; 
    text-align: center;
    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .table.main { background: #f43f5e; color: white; border: none; }

  /* é«˜äº®æ•ˆæœå„ªåŒ–ï¼šæ¸›å°‘é‡ç¹ªï¼Œåªä½¿ç”¨ transform */
  .table.highlight { 
    background: #3b82f6 !important; color: white !important; 
    transform: scale(1.2); 
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); 
    z-index: 5; 
  }

  .badge { padding: 4px 10px; border-radius: 6px; color: white; font-size: 12px; }
  .badge.main { background: #f43f5e; }
  .badge.normal { background: #3b82f6; }

  @media (max-width: 480px) {
    .table { width: 38px; height: 38px; font-size: 10px; }
    h1 { font-size: 22px; }
  }
</style>
</head>
<body>

<div class="container">
  <h1 style="text-align:center; margin: 20px 0 5px;">ğŸ§§ å°¾ç‰™åº§ä½æŸ¥è©¢</h1>
  <p style="text-align:center; color: #666; margin-bottom: 20px; font-size: 14px;">è«‹è¼¸å…¥ã€Œå§“åã€æˆ–ã€Œæ¡Œè™Ÿã€æŸ¥è©¢</p>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="æœå°‹å§“åæˆ–æ¡Œè™Ÿ..." onkeypress="if(event.key==='Enter') searchGuest()" enterkeyhint="search">
    <button onclick="searchGuest()">æŸ¥è©¢</button>
  </div>

  <div id="resultContainer"></div>

  <div class="card">
    <h3 style="text-align:center; margin-bottom:10px; font-size: 16px;">ğŸ—ºï¸ å®´æœƒå»³åº§ä½åœ–</h3>
    <div class="seating-wrapper">
      <div class="seating" id="seatingLayout"></div>
    </div>
    <div style="text-align: center; color: #999; font-size: 11px; margin-top: 5px;">å·¦å³æ»‘å‹•æŸ¥çœ‹å…¨å€ â†”ï¸</div>
    
    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 15px; font-size: 12px;">
      <span style="display:flex; align-items:center; gap:4px;"><i style="width:12px; height:12px; background:#f43f5e; border-radius:50%;"></i>ä¸»æ¡Œ</span>
      <span style="display:flex; align-items:center; gap:4px;"><i style="width:12px; height:12px; background:#fff; border:1px solid #ddd; border-radius:50%;"></i>ä¸€èˆ¬</span>
      <span style="display:flex; align-items:center; gap:4px;"><i style="width:12px; height:12px; background:#3b82f6; border-radius:50%;"></i>ä½ç½®</span>
    </div>
  </div>
</div>

<script>
// ...ï¼ˆJavaScript éƒ¨åˆ†ä¿æŒåŸæœ¬é‚è¼¯ï¼Œä½†åœ¨ highlightTables åŠ å…¥ä¸€é»é˜²æŠ–å„ªåŒ–ï¼‰...
let quests = [];
const seatingLayoutData = [
  ['04', null, 'ä¸»æ¡ŒA', 'ä¸»æ¡ŒB', 'ä¸»æ¡ŒC', , '35', '42'],
  ['05', '11', '17', , '23', '29', '36', '43'],
  ['06', '12', '18', , '24', '30', '37', '44'],
  ['07', '13', '19', , '25', '31', '38', null],
  ['08', '14', '20', , '26', '32', '39', null],
  ['09', '15', '21', , '27', '33', '40', '45'],
  ['10', '16', '22', , '28', '34', '41', null]
];

async function loadQuestData() {
  try {
    const response = await fetch('quests.csv'); 
    if (!response.ok) throw new Error();
    const csvText = await response.text();
    const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
    quests = lines.slice(1).map(line => {
      const columns = line.split(',').map(c => c.trim());
      return { name: columns[0], table: columns[1], count: parseInt(columns[2]) || 1, note: columns[3] || '' };
    });
  } catch (err) {
    document.getElementById('resultContainer').innerHTML = `<div class="card" style="color:#e11d48; text-align:center;">âš ï¸ è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹ç¢ºèª quests.csv æ˜¯å¦æ­£ç¢ºã€‚</div>`;
  }
}

function searchGuest() {
  let query = document.getElementById('searchInput').value.trim().toUpperCase();
  if (!query) return;
  document.getElementById('searchInput').blur();
  
  const results = quests.filter(q => 
    q.name.toUpperCase().includes(query) || 
    q.table.toUpperCase().includes(query) ||
    ( /^\d+$/.test(query) && q.table === query.padStart(2, '0'))
  );

  const container = document.getElementById('resultContainer');
  if (results.length === 0) {
    container.innerHTML = `<div class="card" style="text-align:center;">æŸ¥ç„¡ "${query}"</div>`;
    highlightTables([]);
  } else if (results.length === 1 && !query.includes("ä¸»æ¡Œ") && !(/^\d+$/.test(query))) {
    const q = results[0];
    container.innerHTML = `
      <div class="card">
        <b>${q.name}</b> (${q.count}ä½) <br>
        <span class="badge ${q.table.includes('ä¸»æ¡Œ')?'main':'normal'}">æ¡Œè™Ÿï¼š${q.table}</span>
        ${q.note ? `<div style="margin-top:10px; font-size:13px; color:#92400e;">Note: ${q.note}</div>` : ''}
      </div>`;
    highlightTables([q.table]);
  } else {
    container.innerHTML = `
      <div class="card">
        <div class="guest-list">
          ${results.map(q => `<div class="guest-item" onclick="selectGuest('${q.name}')"><span>${q.name}</span><span class="badge ${q.table.includes('ä¸»æ¡Œ')?'main':'normal'}">${q.table}</span></div>`).join('')}
        </div>
      </div>`;
    highlightTables([...new Set(results.map(r => r.table))]);
  }
}

function selectGuest(name) {
  document.getElementById('searchInput').value = name;
  searchGuest();
}

function highlightTables(targetTables) {
  const seatingDiv = document.getElementById('seatingLayout');
  seatingDiv.innerHTML = '';
  seatingLayoutData.forEach(row => {
    const rowDiv = document.createElement('div');
    rowDiv.className = 'row';
    row.forEach(tableId => {
      const div = document.createElement('div');
      div.className = 'table' + (tableId === null ? ' empty' : (tableId.includes('ä¸»æ¡Œ') ? ' main' : ''));
      if (tableId) {
        div.textContent = tableId;
        if (targetTables.includes(tableId)) {
          div.classList.add('highlight');
          // å»¶é²æ»¾å‹•ç¢ºä¿ DOM æ¸²æŸ“å®Œç•¢ï¼Œä¸¦ä½¿ç”¨ block: 'center' è®“æ‰‹æ©Ÿç«¯çœ‹å¾—æ›´æ¸…æ¥š
          setTimeout(() => div.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' }), 100);
        }
      }
      rowDiv.appendChild(div);
    });
    seatingDiv.appendChild(rowDiv);
  });
}

loadQuestData();
highlightTables([]);
</script>
</body>
</html>
